<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø±Ø¶Ù‰ - Ù†Ø¸Ø§Ù… ØªØ°ÙƒÙŠØ± Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .medication-card {
            transition: all 0.3s ease;
        }
        .medication-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .taken {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .missed {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .pending {
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-capsule"></i> Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø±Ø¶Ù‰
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#medications">Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#logs">Ø§Ù„Ø³Ø¬Ù„Ø§Øª</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div id="dashboard" class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-calendar-day"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠ</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped" id="dailyMedicationsTable">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th>
                                        <th>Ø§Ù„Ø¬Ø±Ø¹Ø©</th>
                                        <th>Ø§Ù„ÙˆÙ‚Øª</th>
                                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯</h5>
                    </div>
                    <div class="card-body">
                        <form id="addMedicationForm">
                            <div class="mb-3">
                                <label for="medicationName" class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡</label>
                                <input type="text" class="form-control" id="medicationName" required>
                            </div>
                            <div class="mb-3">
                                <label for="dosage" class="form-label">Ø§Ù„Ø¬Ø±Ø¹Ø©</label>
                                <input type="text" class="form-control" id="dosage" placeholder="Ù…Ø«Ø§Ù„: 1 Ø­Ø¨Ø©" required>
                            </div>
                            <div class="mb-3">
                                <label for="frequency" class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹</label>
                                <select class="form-select" id="frequency" required>
                                    <option value="1">Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</option>
                                    <option value="2">Ù…Ø±ØªÙŠÙ†</option>
                                    <option value="3">Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª</option>
                                    <option value="4">Ø£Ø±Ø¨Ø¹ Ù…Ø±Ø§Øª</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="times" class="form-label">Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</label>
                                <div id="timesContainer">
                                    <input type="time" class="form-control mb-2" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="bi bi-check-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ§Ø¡
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="medications" class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-list-ul"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="medicationsList">
                            <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="logs" class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-journal-text"></i> Ø³Ø¬Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="complianceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ù„ØªØ£ÙƒÙŠØ¯ Ø£Ø®Ø° Ø§Ù„Ø¯ÙˆØ§Ø¡ -->
    <div class="modal fade" id="confirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ØªØ£ÙƒÙŠØ¯ Ø£Ø®Ø° Ø§Ù„Ø¯ÙˆØ§Ø¡</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Ù‡Ù„ ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ Ø£Ø®Ø°Øª Ø§Ù„Ø¯ÙˆØ§Ø¡ <strong id="confirmMedicationName"></strong>ØŸ</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="button" class="btn btn-success" id="confirmTake">ØªØ£ÙƒÙŠØ¯</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© - Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        let medications = [
            { id: 1, name: 'Ø£Ù…ÙˆÙƒØ³ÙŠØ³ÙŠÙ„ÙŠÙ†', dosage: '500 Ù…Ø¬Ù…', times: ['08:00', '14:00', '20:00'], taken: [false, false, false] },
            { id: 2, name: 'Ø¥ÙŠØ¨ÙˆØ¨Ø±ÙˆÙÙŠÙ†', dosage: '200 Ù…Ø¬Ù…', times: ['09:00', '15:00'], taken: [false, false] }
        ];

        let logs = [
            { date: '2023-10-01', medication: 'Ø£Ù…ÙˆÙƒØ³ÙŠØ³ÙŠÙ„ÙŠÙ†', taken: true },
            { date: '2023-10-01', medication: 'Ø¥ÙŠØ¨ÙˆØ¨Ø±ÙˆÙÙŠÙ†', taken: false },
            // ... Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        ];

        function updateDailyTable() {
            const tableBody = document.getElementById('dailyMedicationsTable').querySelector('tbody');
            tableBody.innerHTML = '';

            const today = new Date().toISOString().split('T')[0];

            medications.forEach(med => {
                med.times.forEach((time, index) => {
                    const row = document.createElement('tr');
                    const status = med.taken[index] ? 'taken' : 'pending';
                    const statusText = med.taken[index] ? 'ØªÙ… Ø§Ù„Ø£Ø®Ø°' : 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                    const statusClass = med.taken[index] ? 'text-success' : 'text-warning';

                    row.innerHTML = `
                        <td>${med.name}</td>
                        <td>${med.dosage}</td>
                        <td>${time}</td>
                        <td><span class="badge bg-${med.taken[index] ? 'success' : 'warning'}">${statusText}</span></td>
                        <td>
                            ${!med.taken[index] ? `<button class="btn btn-sm btn-success take-med-btn" data-med-id="${med.id}" data-time-index="${index}">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø£Ø®Ø°</button>` : ''}
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            });

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.take-med-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const medId = parseInt(this.dataset.medId);
                    const timeIndex = parseInt(this.dataset.timeIndex);
                    const med = medications.find(m => m.id === medId);
                    document.getElementById('confirmMedicationName').textContent = med.name;
                    document.getElementById('confirmTake').dataset.medId = medId;
                    document.getElementById('confirmTake').dataset.timeIndex = timeIndex;
                    new bootstrap.Modal(document.getElementById('confirmModal')).show();
                });
            });
        }

        function updateMedicationsList() {
            const container = document.getElementById('medicationsList');
            container.innerHTML = '';

            medications.forEach(med => {
                const col = document.createElement('div');
                col.className = 'col-md-6 mb-3';
                col.innerHTML = `
                    <div class="card medication-card">
                        <div class="card-body">
                            <h6 class="card-title">${med.name}</h6>
                            <p class="card-text">Ø§Ù„Ø¬Ø±Ø¹Ø©: ${med.dosage}</p>
                            <p class="card-text">Ø§Ù„Ø£ÙˆÙ‚Ø§Øª: ${med.times.join(', ')}</p>
                            <button class="btn btn-sm btn-outline-danger delete-med-btn" data-med-id="${med.id}">Ø­Ø°Ù</button>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù
            document.querySelectorAll('.delete-med-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const medId = parseInt(this.dataset.medId);
                    medications = medications.filter(m => m.id !== medId);
                    updateMedicationsList();
                    updateDailyTable();
                });
            });
        }

        function updateComplianceChart() {
            const ctx = document.getElementById('complianceChart').getContext('2d');
            const complianceData = logs.reduce((acc, log) => {
                if (!acc[log.date]) acc[log.date] = { total: 0, taken: 0 };
                acc[log.date].total++;
                if (log.taken) acc[log.date].taken++;
                return acc;
            }, {});

            const labels = Object.keys(complianceData);
            const data = labels.map(date => (complianceData[date].taken / complianceData[date].total) * 100);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… (%)',
                        data: data,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙƒØ±Ø§Ø±
        document.getElementById('frequency').addEventListener('change', function() {
            const frequency = parseInt(this.value);
            const container = document.getElementById('timesContainer');
            container.innerHTML = '';
            for (let i = 0; i < frequency; i++) {
                const input = document.createElement('input');
                input.type = 'time';
                input.className = 'form-control mb-2';
                input.required = true;
                container.appendChild(input);
            }
        });

        // Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ§Ø¡ Ø¬Ø¯ÙŠØ¯
        document.getElementById('addMedicationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('medicationName').value;
            const dosage = document.getElementById('dosage').value;
            const times = Array.from(document.querySelectorAll('#timesContainer input')).map(input => input.value);

            const newMed = {
                id: medications.length + 1,
                name: name,
                dosage: dosage,
                times: times,
                taken: new Array(times.length).fill(false)
            };

            medications.push(newMed);
            updateMedicationsList();
            updateDailyTable();
            this.reset();
            document.getElementById('frequency').dispatchEvent(new Event('change'));
        });

        // ØªØ£ÙƒÙŠØ¯ Ø£Ø®Ø° Ø§Ù„Ø¯ÙˆØ§Ø¡
        document.getElementById('confirmTake').addEventListener('click', function() {
            const medId = parseInt(this.dataset.medId);
            const timeIndex = parseInt(this.dataset.timeIndex);
            const med = medications.find(m => m.id === medId);
            med.taken[timeIndex] = true;

            // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
            logs.push({
                date: new Date().toISOString().split('T')[0],
                medication: med.name,
                taken: true
            });

            updateDailyTable();
            updateComplianceChart();
            bootstrap.Modal.getInstance(document.getElementById('confirmModal')).hide();
        });

        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        if ('Notification' in window) {
            Notification.requestPermission();
        }

        // ÙØ­Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
        setInterval(() => {
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');

            medications.forEach(med => {
                med.times.forEach((time, index) => {
                    if (time === currentTime && !med.taken[index]) {
                        if (Notification.permission === 'granted') {
                            new Notification(`ØªØ°ÙƒÙŠØ±: ${med.name}`, {
                                body: `Ø­Ø§Ù† ÙˆÙ‚Øª Ø£Ø®Ø° Ø¬Ø±Ø¹Ø© ${med.dosage}`,
                                icon: 'https://via.placeholder.com/64x64?text=ğŸ’Š'
                            });
                        }
                        // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ©
                    }
                });
            });
        }, 60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            updateDailyTable();
            updateMedicationsList();
            updateComplianceChart();
            document.getElementById('frequency').dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>
